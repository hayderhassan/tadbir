.PHONY: all install dev test clean help

VENV := .venv
PYTHON := $(VENV)/bin/python
PIP := $(VENV)/bin/pip
PYTEST := $(VENV)/bin/pytest -q
PYTHON_DEPS := requests pydantic pytest

all: dev

help:
	@echo " ğŸ“¦ install           Install dependencies"
	@echo " ğŸ§¹ clean             Remove build artifacts"
	@echo " ğŸš€ dev               Start development server"
	@echo " ğŸ§ª test              Run tests"

install:
	@echo "ğŸ“¦ Installing Simulator dependencies..."
	@python3 -m venv $(VENV)
	@$(PIP) install -U pip wheel
	@$(PIP) install $(PYTHON_DEPS)
	@$(PIP) freeze > requirements.txt
	@echo "âœ… Simulator venv ready."

clean:
	@echo "ğŸ§¹ Cleaning Simulator environment..."
	@find . -type d \( -name '__pycache__' -o -name '.pytest_cache' \) -exec rm -rf {} +
	@rm -rf $(VENV)

dev:
	@test -d $(VENV) || $(MAKE) install
	@echo "ğŸš€ Starting Simulator..."
	@$(PYTHON) simulate.py

test:
	@test -d $(VENV) || $(MAKE) install
	@echo "ğŸ§ª Running Simulator tests..."
	@$(PYTEST) || echo "âš ï¸  Tests failed"
