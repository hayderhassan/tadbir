.PHONY: all install dev build start test clean lint format help

NODE_MODULES := node_modules
NEXT_BUILD := .next

all: dev

help:
	@echo " ğŸ“¦ install           Install dependencies"
	@echo " ğŸ”§ build             Build the project"
	@echo " ğŸ§¹ clean             Remove build artifacts"
	@echo " ğŸš€ dev               Start development server"
	@echo " ğŸ start             Start production server"
	@echo " ğŸ” lint              Lint the project code"
	@echo " ğŸ¨ format            Format the project code"
	@echo " ğŸ§ª test              Run tests"

install:
	@echo "ğŸ“¦ Installing Manarah dependencies..."
	@if [ -f pnpm-lock.yaml ]; then \
		echo "ğŸ”’ Lockfile found. Installing with pinned versions..."; \
		pnpm install --frozen-lockfile; \
	else \
		echo "âš ï¸  Lockfile missing. Installing with latest compatible versions..."; \
		pnpm install; \
		echo "ğŸ“ Generating new lockfile..."; \
	fi

build:
	@echo "ğŸ”§ Building Manarah project..."
	@pnpm build

clean:
	@echo "ğŸ§¹ Cleaning Manarah build artifacts..."
	@rm -rf $(NODE_MODULES) $(NEXT_BUILD)

dev:
	@test -d $(NODE_MODULES) || $(MAKE) install
	@echo "ğŸš€ Starting Manarah development server..."
	@pnpm dev

start:
	@test -d $(NEXT_BUILD) || $(MAKE) build
	@echo "ğŸ Starting Manarah production server..."
	@pnpm start

lint:
	@echo "ğŸ” Linting Manarah code..."
	@pnpm lint

format:
	@echo "ğŸ¨ Formatting Manarah code..."
	# @pnpm format

test:
	@test -d $(NODE_MODULES) || $(MAKE) install
	@echo "ğŸ§ª No Manarah test plan yet. Skipping..."
